toTimeOrNull:




input:

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;
import java.io.IOException;
import java.time.OffsetTime;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeFormatterBuilder;
import java.time.format.DateTimeParseException;
import java.util.Locale;

public class DataWeaveToTimeOrNullConverter {

    private final ObjectMapper objectMapper = new ObjectMapper();
    private final String sourceTimeString = "13:44:12.283-08:00";

    /**
     * Mimics DataWeave's toTimeOrNull() behavior with chained formatters.
     * Returns the parsed OffsetTime upon success, or null if all formatters fail.
     */
    private OffsetTime toTimeOrNull(String timeString, DateTimeFormatter... formatters) {
        for (DateTimeFormatter formatter : formatters) {
            try {
                // Attempt to parse with the current formatter
                return OffsetTime.parse(timeString, formatter);
            } catch (DateTimeParseException e) {
                // DataWeave's behavior: swallow the exception and continue to the next formatter
            }
        }
        // If the loop completes without a successful parse, return null
        return null; 
    }

    public String getTimeParsingJson() throws IOException {
        
        // Define formatters
        // Format 1: HH:mm:ss.xxx (Java equivalent with required 3-digit fraction and offset)
        DateTimeFormatter formatter1 = DateTimeFormatter.ofPattern("HH:mm:ss.SSSXXX", Locale.US); 

        // Format 2: HH:mm:ss.nxxx (Java equivalent allowing variable fractional seconds and offset)
        DateTimeFormatter formatter2 = new DateTimeFormatterBuilder()
            .appendPattern("HH:mm:ss")
            .appendFraction(java.time.temporal.ChronoField.NANO_OF_SECOND, 1, 9, true)
            .appendPattern("XXX")
            .toFormatter(Locale.US);
        
        // --- Logic for Key 'a' (Success after chain) ---
        // Try formatter1 (fails), then formatter2 (succeeds)
        OffsetTime parsedTimeA = toTimeOrNull(sourceTimeString, formatter1, formatter2);

        // --- Logic for Key 'b' (Failure) ---
        // Only try formatter1 (fails), resulting in null
        OffsetTime parsedTimeB = toTimeOrNull(sourceTimeString, formatter1);
        
        // 1. Create the root JSON object
        ObjectNode root = objectMapper.createObjectNode();

        // 2. Add the results to the JSON object
        // Jackson serializes OffsetTime as a standard ISO string or null.
        root.put("a", parsedTimeA != null ? parsedTimeA.toString() : null);
        root.put("b", parsedTimeB != null ? parsedTimeB.toString() : null);

        // Convert the root object to a JSON string
        return objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(root);
    }

    public static void main(String[] args) {
        DataWeaveToTimeOrNullConverter converter = new DataWeaveToTimeOrNullConverter();
        try {
            String jsonOutput = converter.getTimeParsingJson();
            System.out.println(jsonOutput);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

output:


{
  "a" : "13:44:12.283-08:00",
  "b" : null
}

