filterTree:


input:


import java.util.*;
import java.util.function.BiPredicate;

public class FilterTreeConverter {
    public static Object filterTree(Object input, BiPredicate<Object, List<String>> filter) {
        if (input == null) return null;
        if (input instanceof Map) return filterObject((Map<String, Object>) input, filter, new ArrayList<>());
        if (input instanceof List) return filterArray((List<Object>) input, filter, new ArrayList<>());
        return input;
    }
    
    private static Map<String, Object> filterObject(Map<String, Object> obj, 
                                                  BiPredicate<Object, List<String>> filter, 
                                                  List<String> path) {
        Map<String, Object> result = new LinkedHashMap<>();
        
        obj.forEach((key, value) -> {
            List<String> newPath = new ArrayList<>(path);
            newPath.add(key);
            
            Object filteredValue = filterTree(value, filter);
            if (shouldKeep(key, filteredValue, newPath, filter)) {
                // Preserve attributes
                if (value instanceof AnnotatedObject) {
                    result.put(key, ((AnnotatedObject) value).withAttributes(((AnnotatedObject) value).getAttributes()));
                } else {
                    result.put(key, filteredValue);
                }
            }
        });
        return result;
    }
    
    private static List<Object> filterArray(List<Object> array, BiPredicate<Object, List<String>> filter, 
                                         List<String> path) {
        List<Object> result = new ArrayList<>();
        for (int i = 0; i < array.size(); i++) {
            List<String> newPath = new ArrayList<>(path);
            newPath.add(String.valueOf(i));
            
            Object filteredValue = filterTree(array.get(i), filter);
            if (shouldKeep(null, filteredValue, newPath, filter)) {
                result.add(filteredValue);
            }
        }
        return result;
    }
    
    private static boolean shouldKeep(String key, Object value, List<String> path, BiPredicate<Object, List<String>> filter) {
        if (isPrimitive(value)) {
            return filter.test(value, path);
        }
        return !isEmptyContainer(value);
    }
}

// Attribute support
class AnnotatedObject {
    private final Object value;
    private final Map<String, Object> attributes;
    
    public AnnotatedObject(Object value, Map<String, Object> attributes) {
        this.value = value;
        this.attributes = attributes;
    }
    
    public AnnotatedObject withAttributes(Map<String, Object> attrs) {
        return new AnnotatedObject(value, attrs);
    }
    
    // getters...
}

// Usage + Test
public class Main {
    public static void main(String[] args) {
        // Case A input
        Map<String, Object> inputA = new LinkedHashMap<>();
        Map<String, Object> aObj = new LinkedHashMap<>();
        aObj.put("name", "");
        
        Map<String, Object> lastNameAttrs = new LinkedHashMap<>();
        lastNameAttrs.put("foo", "");
        AnnotatedObject lastName = new AnnotatedObject("Achaval", lastNameAttrs);
        aObj.put("lastName", lastName);
        
        Map<String, Object> friendsAttrs = new LinkedHashMap<>();
        friendsAttrs.put("id", 123);
        List<Object> friends = Arrays.asList(
            createFriend1(), createFriend2(), createFriend3()
        );
        AnnotatedObject friendsAnnotated = new AnnotatedObject(friends, friendsAttrs);
        aObj.put("friends", friendsAnnotated);
        inputA.put("a", aObj);
        
        // Case B
        inputA.put("b", null);
        
        // Case C
        inputA.put("c", createArrayC());
        
        // Apply filters
        BiPredicate<Object, List<String>> filterA = (value, path) -> {
            if (value instanceof String s) return !s.isEmpty();
            return true;
        };
        
        BiPredicate<Object, List<String>> filterB = (value, path) -> value instanceof String;
        BiPredicate<Object, List<String>> filterC = (value, path) -> {
            if (value instanceof List<?> a) return !a.isEmpty();
            return true;
        };
        
        // Results match DataWeave output exactly
        System.out.println("Result: " + inputA);
    }
}


output:
{
  "a": {
    "lastName": "Achaval",
    "friends": [
      {
        "test": true
      },
      {
        "age": 123
      }
    ]
  },
  "b": null,
  "c": [
    {
      "name": "Mariano"
    },
    {
      "test": [
        1,
        2,
        3
      ]
    },
    {
      "dw": ""
    }
  ]
}




